<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VerificationProcess component test suite</title>

    <script src="../../../../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../../../node_modules/web-component-tester/browser.js"></script>

    <script src="../../helpers/redux-hack.js"></script>
    <script src="../../helpers/wait.js"></script>
    <script type="module" src="../../../../src/blockcerts-verifier/index.js"></script>
</head>
<body>
<test-fixture id="success">
    <template>
        <blockcerts-verifier src="https://certificates.learningmachine.com/certificate/34299968e25f5c9985a2f7de988c4bd0"></blockcerts-verifier>
    </template>
</test-fixture>

<script type="module">
  xdescribe('VerificationProcess test suite', function () {
    describe('given the certificate verification has succeeded', function () {
      it('should show the correct verification label', async function () {
        const el = fixture('success').shadowRoot.querySelectorAll('buv-raw')[0];
        await wait(1000);
        const verificationProcessModalElement = el.shadowRoot.querySelectorAll('buv-verification-modal')[0];
        await wait(1000);
        const verificationProcessElement = verificationProcessModalElement.shadowRoot.querySelectorAll('buv-verification-process')[0];
        await wait(1000);
        const verificationProcessRawElement = verificationProcessElement.shadowRoot.querySelectorAll('buv-verification-process-raw')[0];
        await wait(5000);
        const finalStepElement = verificationProcessRawElement.shadowRoot.querySelectorAll('buv-final-verification-step')[0];
        const finalStepTitleText = finalStepElement.shadowRoot.querySelectorAll('.buv-qa-verification-step')[0].innerText;
        expect(finalStepTitleText).to.equal('Verified');
      });

      it('should show the correct verification description', async function () {
        const el = fixture('success').shadowRoot.querySelectorAll('buv-raw')[0];
        await wait(1000);
        const verificationProcessModalElement = el.shadowRoot.querySelectorAll('buv-verification-modal')[0];
        await wait(1000);
        const verificationProcessElement = verificationProcessModalElement.shadowRoot.querySelectorAll('buv-verification-process')[0];
        await wait(1000);
        const verificationProcessRawElement = verificationProcessElement.shadowRoot.querySelectorAll('buv-verification-process-raw')[0];
        await wait(5000);
        const finalStepElement = verificationProcessRawElement.shadowRoot.querySelectorAll('buv-final-verification-step')[0];
        const finalStepDescriptionText = finalStepElement.shadowRoot.querySelectorAll('.buv-qa-final-step-description')[0].innerText;
        expect(finalStepDescriptionText).to.equal('This is a valid Bitcoin certificate.');
      });

      it('should show the correct verification link to the transaction', async function () {
        const el = fixture('success').shadowRoot.querySelectorAll('buv-raw')[0];
        await wait(1000);
        const verificationProcessModalElement = el.shadowRoot.querySelectorAll('buv-verification-modal')[0];
        await wait(1000);
        const verificationProcessElement = verificationProcessModalElement.shadowRoot.querySelectorAll('buv-verification-process')[0];
        await wait(1000);
        const verificationProcessRawElement = verificationProcessElement.shadowRoot.querySelectorAll('buv-verification-process-raw')[0];
        await wait(5000);
        const finalStepElement = verificationProcessRawElement.shadowRoot.querySelectorAll('buv-final-verification-step')[0];
        const transactionLinkText = finalStepElement.shadowRoot.querySelectorAll('.buv-qa-transaction-link')[0].innerText;
        expect(transactionLinkText).to.equal('View transaction link');
      });
    });
  });
</script>
</body>
</html>
